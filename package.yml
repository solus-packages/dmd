name       : dmd
version    : 2.077.0
release    : 6
source     :
    - git|https://github.com/dlang/dmd : v2.077.0
    - git|https://github.com/dlang/druntime : v2.077.0
    - git|https://github.com/dlang/phobos : v2.077.0
license    : BSL-1.0
component  : programming
summary    : Compiler and standard library for the D programming language
description: |
    D is a systems programming language with C-like syntax and static typing. It combines efficiency, control and modeling power with safety and programmer productivity.
libsplit   : no
builddeps  :
    - dmd
patterns   :
    - /usr/include/*
    - /usr/lib64/*
extract : no
setup      : |
    cp -r $sources/dmd.git $workdir/dmd
    cp -r $sources/druntime.git $workdir/druntime
    cp -r $sources/phobos.git $workdir/phobos
    SUBFOLDERS=$(ls $workdir)
    mkdir -p $workdir/stage1
    for SUBFOLDER in $SUBFOLDERS; do cp -R $workdir/$SUBFOLDER $workdir/stage1; done
build      : |
    unset LD_FLAGS
    export CXX_KIND="g++"
    cd $workdir/../stage1/dmd
    %make -f posix.mak
    cd $workdir/../stage1/druntime
    %make -f posix.mak DMD=$workdir/../stage1/dmd/src/dmd
    cd $workdir/../stage1/phobos
    %make -f posix.mak DMD=$workdir/../stage1/dmd/src/dmd
    cd $workdir/../dmd
    %make -f posix.mak DMD=$workdir/../stage1/dmd/src/dmd
    cd $workdir/../druntime
    %make -f posix.mak DMD=$workdir/../dmd/src/dmd
    cd $workdir/../phobos
    %make -f posix.mak DMD=$workdir/../dmd/src/dmd
install    : |
    unset LD_FLAGS
    install -Dm00755 $workdir/../dmd/src/dmd $installdir/usr/bin/dmd
    install -dm00644 $installdir/usr/include/dlang/dmd
    cp -r $workdir/../phobos/{*.d,etc,std} $installdir/usr/include/dlang/dmd
    cp -r $workdir/../druntime/import/* $installdir/usr/include/dlang/dmd
    install -Dm00744 $workdir/../phobos/generated/linux/release/64/libphobos2.a $installdir/usr/lib64/libphobos2.a
    install -Dm00755 $workdir/../phobos/generated/linux/release/64/libphobos2.so $installdir/usr/lib64/libphobos2.so
    install -Dm00755 $workdir/../phobos/generated/linux/release/64/libphobos2.so.0.* $installdir/usr/lib64/
    install -Dm00644 $pkgfiles/dmd.conf $installdir/etc/dmd.conf
    install -dm00644 $installdir/usr/share/man/
    cp -r docs/man/* $installdir/usr/share/man/
